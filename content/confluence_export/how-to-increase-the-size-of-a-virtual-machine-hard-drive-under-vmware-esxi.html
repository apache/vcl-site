<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>


  <link href="/css/vcl.css" rel="stylesheet" type="text/css">
  <link href="/css/code.css" rel="stylesheet" type="text/css">
  <title>Apache VCL - How to Increase the Size of a Virtual Machine Hard Drive under VMware ESXi</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
  <div id="sitetitle">
    <table width="100%" border="0" cellspacing="0" cellpadding="5">
      <tr>
         <td><a href="/index.html"><img src="/img/vcl-logo.png" height="100" align="left" alt="Apache VCL logo"></a></td>
         <td><a href="http://www.apache.org"><img src="/img/asf-logo.png" align="right" alt="Apache Software Foundation logo"></a></td>
      </tr>
    </table>
  </div>
  
  <div id="left-column">
    <div id="navigation">
      <ul>
<li><a href="/index.html">Information</a>
<ul>
<li><a href="/info/features.html">Features</a></li>
<li><a href="/info/architecture.html">Architecture</a></li>
<li><a href="/downloads/download.cgi">Download</a></li>
<li><a href="http://www.apache.org/licenses/">License</a></li>
<li><a href="http://www.apache.org/security/">Security</a></li>
</ul>
</li>
<li><a href="/docs/index.html">Documentation</a>
<ul>
<li><a href="https://cwiki.apache.org/confluence/x/yQdG">Using VCL</a></li>
<li><a href="https://cwiki.apache.org/confluence/x/ywdG">Administration</a></li>
<li><a href="/docs/installation.html">Installation</a></li>
</ul>
</li>
<li><a href="https://cwiki.apache.org/confluence/display/VCL/Apache+VCL" target="_blank">Confluence Wiki</a>
  <ul>
      <li></li>
  </ul>
</li>
<li><a href="https://issues.apache.org/jira/browse/VCL" target="_blank">Jira Issue Tracking</a>
  <ul>
      <li></li>
  </ul>
</li>
<li><a href="/comm/index.html">Community</a>
<ul>
<li><a href="/comm/index.html#getInvolved">Getting Involved</a></li>
<li><a href="/comm/index.html#mail-list">Mailing Lists</a></li>
<li><a href="/dev/index.html">Development</a>
<ul>
<li><a href="/dev/code-documentation.html">Code Documentation</a></li>
<li><a href="/dev/roadmap.html">Roadmap</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="http://www.apache.org">Apache Software Foundation</a>
<ul>
<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
<li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
</ul>
</li>
</ul>
    </div>
    <div id="current-event"> 
      <a  href="https://www.apache.org/events/current-event.html">
        <img src="https://www.apache.org/events/current-event-125x125.png" alt="Apache current event" />
      </a>
    </div>
  </div>
  
  <div id="content">
    <h1 class="title">How to Increase the Size of a Virtual Machine Hard Drive under VMware ESXi</h1>
    
	<p>{excerpt}This page describes how to increase the size of a VM&rsquo;s hard drive.
This is useful if additional space is needed to install large
applications.{excerpt}</p>
<p><a name="HowtoIncreasetheSizeofaVirtualMachineHardDriveunderVMwareESXi-CreateaFullCopyoftheVirtualDisk"></a></p>
<h3 id="create-a-full-copy-of-the-virtual-disk">Create a Full Copy of the Virtual Disk</h3>
<ul>
<li>Determine the VMware host the VM is on</li>
<li>Shutdown the VM</li>
<li>Log in to the VM host via SSH</li>
<li>Navigate to the VM&rsquo;s working directory <em>(under the VM Working Directory
Path configured in the VM profile)</em></li>
</ul>
<p>{tip:icon=false}cd /vmfs/volumes/vmpath/vclv99-77_1846-v14{tip}</p>
<p>You should see several files in the directory:</p>
<pre><code>/vmfs/volumes/19873c05-fcd3d912/vclv99-77_1846-v14 # ls -l
-rw-rw----    1 root	 root		    8684 Aug 13 16:34 nvram
-rw-------    1 root	 root	      4294967296 Aug 13 16:32
</code></pre>
<p>vclv99-77_1846-v14-6197888b.vswp
-rw-rw&mdash;-    1 root	 root		   18926 Aug 13 16:32
vclv99-77_1846-v14-Snapshot1.vmsn
-rw-rw&mdash;-    1 root	 root		     498 Aug 13 16:32
vclv99-77_1846-v14.vmsd
&ndash;wxrw&ndash;wx    1 root	 root		    3464 Aug 13 16:37
vclv99-77_1846-v14.vmx
&ndash;w-rw&ndash;w-    1 root	 root		     273 Aug 13 16:32
vclv99-77_1846-v14.vmxf
-rw-r&ndash;r&ndash;    1 root	 root		  137538 Aug 13 16:43 vmware.log
-rw-rw&mdash;-    1 root	 root	       268505088 Aug 13 19:50
vmwarewin7-Windows764bit1846-v14-000001-delta.vmdk
-rw-rw&mdash;-    1 root	 root		     432 Aug 13 16:32
vmwarewin7-Windows764bit1846-v14-000001.vmdk</p>
<p>The VM is configured to run in linked clone mode because a snapshot was
created before the VM was powered on for the first time.  The .vmdk files
in this directory only contain changes made to the master image.  The
master image can be determined by lookin in the vmsn file:</p>
<pre><code>A full copy of the master image and delta files needs to be created in
</code></pre>
<p>order to be able to resize the virtual disk.  Run the following command
from the VM&rsquo;s working directory on the VM host:
{tip:icon=false}vmkfstools -i vmwarewin7-Windows764bit1846-v14-000001.vmdk
copy.vmdk -d thin{tip}</p>
<p>/vmfs/volumes/19873c05-fcd3d912/vclv99-77_1846-v14 # vmkfstools -i
vmwarewin7-Windows764bit1846-v14-000001.vmdk copy.vmdk -d thin
Destination disk format: VMFS thin-provisioned
Cloning disk &lsquo;vmwarewin7-Windows764bit1846-v14-000001.vmdk&rsquo;&hellip;
Clone: 100% done.</p>
<pre><code>h3. Resize the Virtual Disk

Run the following command to resize the virtual disk.  The \-X argument
</code></pre>
<p>should specify the total size you want the virtual disk to be, not the
amount of space to add to it:
{tip:icon=false}vmkfstools -X 50G copy.vmdk{tip}</p>
<pre><code>h3. Download Gparted Live CD

Download the [GParted Live CD ISO image|http://gparted.sourceforge.net/download.php]
</code></pre>
<p>to one of the datastores mounted on the VM host.  The .iso file must
reside on one of the datastores in order to be able to mount it on a VM.</p>
<pre><code>h3. Replace the VM's Hard Drive with the Full Copy

After the copy has been created, reconfigure the VM to use the copy of the
</code></pre>
<p>disk instead of the original linked clone.
* Open vSphere Client
* Right-click on the VM and select <em>Edit Settings&hellip;</em>
* Select <em>Hard disk 1</em>
* Click <em>Remove</em>
* Click <em>Add&hellip;</em>
* Select <em>Use an existing virtual disk</em>
* Navigate to the VM&rsquo;s working directory and select the .vmdk corresponding
to the full copy of the virtual disk you created earlier <em>(copy.vmdk)</em></p>
<pre><code>h3. Add a CD Drive to the VM Pointing to the GParted Live CD ISO File

* Click *Add...*
* Select *CD/DVD Drive*
* *Use ISO image*
* Navigate to the Gparted ISO image you downloaded earlier
* Make sure _Connect at power on_ is selected

!vm-reconfigure.jpg!

h3. Increase the Power On Boot Delay

It can be difficult to catch the initial boot screen when the VM is powered
</code></pre>
<p>on in order to press Escape to display the boot menu.  Add a delay:
* Click on the <em>Options</em> tab
* Select <em>Boot Options</em>
* Set the <em>Power On Boot Delay</em> to a few seconds <em>(4000 = 4 seconds)</em></p>
<pre><code>!vm-boot-delay.jpg|border=1!

h3. Use GParted to Reconfigure the Partitions

Simply increasing the size of the virtual disk does not cause the amount of
</code></pre>
<p>usable space within the VM to increase.  The partitions within the
virtual disk need to be reconfigured to use all of the available
space.  This cannot be done from the OS of the image stored on the
virtual disk.  You must boot the VM using a live CD containing a
partition reconfiguration utility.  The GParted Live CD is free and
easy to use.</p>
<pre><code>* With the VM powered off, select the *Console* tab
* Power on the VM
* Quickly click inside the *Console* pane
* Press *Esc* to display the Boot Menu
* Select *CD-ROM Drive*

The GParted menu should appear.

* Select *GParted Live (Default settings)*
* Accept the defaults



Increase the size of the main partition to use all of the space
* Select the main partition _(should be the largest)_
* Open the *Partition* menu _(use the mouse of press Alt-p if mouse
</code></pre>
<p>operations are difficult)_
* Select *Resize/Move*
* Set *New Size (MiB)* to the _Maximum size_ listed above in the box
* Click *Resize/Move*
* Open the *Edit* menu
* Click *Apply All Operations*
* Click *Apply*
You should eventually see a message stating _All operations successfully
completed_
* Click *Close*
* Reboot the VM to its hard drive
_If a message appears saying the hard drive needs to be checked for
consistency allow the procedure to complete._
* Once the VM is rebooted, log in to the image and verify the size of the
hard drive has been increased</p>
<pre><code>The saved VCL image will contain the larger hard drive.
</code></pre>


  </div>
  
  <div id="footer">
    <div class="copyright">
      <p>
        Copyright &copy; 2020 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        <br />
        Apache and the Apache feather logo are trademarks of The Apache Software Foundation.
      </p>
    </div>
  </div>
  
</body>
</html>
