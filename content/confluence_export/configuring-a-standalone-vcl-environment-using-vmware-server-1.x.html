<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>


  <link href="/css/vcl.css" rel="stylesheet" type="text/css">
  <link href="/css/code.css" rel="stylesheet" type="text/css">
  <title>Apache VCL - Configuring a Standalone VCL Environment using VMware Server 1.x</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
  <div id="sitetitle">
    <table width="100%" border="0" cellspacing="0" cellpadding="5">
      <tr>
         <td><a href="/index.html"><img src="/img/vcl-logo.png" height="100" align="left" alt="Apache VCL logo"></a></td>
         <td><a href="http://www.apache.org"><img src="/img/asf-logo.png" align="right" alt="Apache Software Foundation logo"></a></td>
      </tr>
    </table>
  </div>
  
  <div id="left-column">
    <div id="navigation">
      <ul>
<li><a href="/index.html">Information</a>
<ul>
<li><a href="/info/features.html">Features</a></li>
<li><a href="/info/architecture.html">Architecture</a></li>
<li><a href="/downloads/download.cgi">Download</a></li>
<li><a href="http://www.apache.org/licenses/">License</a></li>
<li><a href="http://www.apache.org/security/">Security</a></li>
</ul>
</li>
<li><a href="/docs/index.html">Documentation</a>
<ul>
<li><a href="https://cwiki.apache.org/confluence/x/yQdG">Using VCL</a></li>
<li><a href="https://cwiki.apache.org/confluence/x/ywdG">Administration</a></li>
<li><a href="/docs/installation.html">Installation</a></li>
</ul>
</li>
<li><a href="https://cwiki.apache.org/confluence/display/VCL/Apache+VCL" target="_blank">Confluence Wiki</a>
  <ul>
      <li></li>
  </ul>
</li>
<li><a href="https://issues.apache.org/jira/browse/VCL" target="_blank">Jira Issue Tracking</a>
  <ul>
      <li></li>
  </ul>
</li>
<li><a href="/comm/index.html">Community</a>
<ul>
<li><a href="/comm/index.html#getInvolved">Getting Involved</a></li>
<li><a href="/comm/index.html#mail-list">Mailing Lists</a></li>
<li><a href="/dev/index.html">Development</a>
<ul>
<li><a href="/dev/code-documentation.html">Code Documentation</a></li>
<li><a href="/dev/roadmap.html">Roadmap</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="http://www.apache.org">Apache Software Foundation</a>
<ul>
<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
<li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
</ul>
</li>
</ul>
    </div>
    <div id="current-event"> 
      <a  href="https://www.apache.org/events/current-event.html">
        <img src="https://www.apache.org/events/current-event-125x125.png" alt="Apache current event" />
      </a>
    </div>
  </div>
  
  <div id="content">
    <h1 class="title">Configuring a Standalone VCL Environment using VMware Server 1.x</h1>
    
	<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-{color:#ff0000}DISCLAIMER\!{color}"></a></p>
<h2 id="colorff0000disclaimercolor">{color:#ff0000}DISCLAIMER!{color}</h2>
<p>This document provides instuctions for configuring a standalone VCL
environment running on a single computer which is able to provision VCL
reservations using VMware.  It is only provided to help you understand
how the various components of VCL operate.  This document <em>DOES NOT</em>
describe how to configure a production VCL environment.  The
environment described in this document can however be used to learn, test,
and help develop VCL.</p>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-InstallVCLComponents"></a></p>
<h2 id="install-vcl-components">Install VCL Components</h2>
<p>Begin by completing the installation instructions for the VCL components:</p>
<ul>
<li><a href="database-configuration.html">Database</a></li>
<li><a href="web-code-installation.html">Web server</a></li>
<li><a href="management-node-installation.html">Management node</a></li>
</ul>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-GatherRequiredFiles&Information"></a></p>
<h2 id="gather-required-files--information">Gather Required Files &amp; Information</h2>
<p>You will need the following:</p>
<ul>
<li>VMware Server 1.x RPM installation file</li>
<li>VMWare Server 1.x serial number</li>
</ul>
<p>The following instructions assume the following locations on the management
node:</p>
<ul>
<li>VMWare Server RPM: /install/VMware-server-1.0.8-126538.i386.rpm</li>
</ul>
<p>These instructions assume you have root access and are using a bash shell:
{panel}
sudo bash
{panel}</p>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-Configure&nbsp;theVCLDatabasefortheVMGuestandHost&nbsp;"></a></p>
<h2 id="configurenbspthe-vcl-database-for-the-vm-guest-and-hostnbsp">Configure the VCL Database for the VM Guest and Host </h2>
<ul>
<li>
<p>Create the following computer groups:
Go to Manage Groups -&gt; Resource Groups -&gt; Add
** all vm host computers
** all vm guest computers</p>
</li>
<li>
<p>Map all computer groups to management node group
** Management Nodes -&gt; Edit Management Node Mapping</p>
</li>
<li>
<p>Configure the management node to check in with the database
** Management Nodes -&gt; Edit Management Node Information -&gt; Add
*** Hostname: localhost
*** IP Address: 127.0.0.1
*** Owner: admin
*** State: available
*** Predictive Loading Module: Predictive Loading Level 0 Module
*** Check-in Interval: 5
*** Install Path: /install
*** End Node SSH Identitiy Key Files: /etc/vcl/vcl.key
*** SSH Port for this node: 22
*** Enable Image Library: no</p>
</li>
<li>
<p>Add VM host computer:
** Manage Computers -&gt; Edit Computer Information -&gt; Submit -&gt; Add
*** Hosthame: localvmhost
*** IP Address: 192.168.0.1 (NOTE: there is currently a bug restricting the
size of the field, so hopefully one octet has less than 3 digits.)
*** State: available
<em>{<em>}Note:</em></em> <em>do not attempt to add the computer in the maintenance
state because of the following issue:</em>
<a href="https://issues.apache.org/jira/browse/VCL-189">https://issues.apache.org/jira/browse/VCL-189</a>
*** Owner: admin
*** Platform: i386
*** Schedule: VCL 24x7 
*** RAM: 1024
*** No Processors: 1
*** Processor Speed: 2000
*** Network Speed: 100 
*** Type: blade
*** Provisioning engine: xCAT 1.x
<em>{<em>}Note:</em></em> <em>the Type and Provisioning engine values don&rsquo;t matter for the
localvmhost computer in this test environment because vcld isn&rsquo;t
provisioning it</em>
*** Computer Groups: all vm host computers</p>
</li>
<li>
<p>Add VM guest computer:
** Manage Computers -&gt; Edit Computer Information -&gt; Submit -&gt; Add
*** Hosthame: vmguest-1
*** IP Address: current public ip address used by Windows XP VM
*** State: available 
*** Owner: admin
*** Platform: i386
*** Schedule: VCL 24x7 
*** RAM: 1024
*** No Processors: 1
*** Processor Speed: 2000
*** Network Speed: 100 
*** Type: virtualmachine
*** Provisioning engine: VMWare Server Provisioning
*** Computer Groups: all vm guest computers</p>
</li>
<li>
<p>Note the fix for the IP address bug is recorded here: <a href="https://issues.apache.org/jira/browse/VCL-193">https://issues.apache.org/jira/browse/VCL-193</a></p>
</li>
<li>
<p>Configure the VM guest&rsquo;s MAC address in the computer table in the
database (as there currently does not seem to be a way to do this through
the UI):
** eth0: 00:50:56:1a:01:01
** eth1: 00:50:56:1a:01:02</p>
</li>
<li>
<p>Configure the VM host profile:
** Virtual Hosts -&gt; VM Host Profiles tab -&gt; VMware GSX standard -&gt;
configure Profile
*** Virtual Switch 0: VMnet1
*** Virtual Switch 1: VMnet0</p>
</li>
<li>
<p>Change state of localvmhost to vmhostinuse (edit the database directly,
do not use the Virtual Hosts utility on the website)</p>
</li>
<li>
<p>Assign vm guests to localvmhost</p>
</li>
<li>
<p>Create node in priviledge tree
** Name: VM image access
** Add resource groups:
*** all vm guest computers
*** all vm guest images</p>
</li>
</ul>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-RemoveExistingVirtualizationComponents"></a></p>
<h2 id="remove-existing-virtualization-components">Remove Existing Virtualization Components</h2>
<p>{panel}
yum groupremove &ldquo;Virtualization&rdquo; -y  
{panel}</p>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-MakeSureTheHostComputerIsNotRunningAXenKernel"></a></p>
<h2 id="make-sure-the-host-computer-is-not-running-a-xen-kernel">Make Sure The Host Computer Is Not Running A Xen Kernel</h2>
<p>VMWare Server cannot be installed on a computer running a Xen kernel. 
To determine if a Xen kernel is being used:
{panel}
uname -a
{panel}The following output indicates a Xen kernel is being used:
{panel}
Linux blade1g6-4 2.6.18-92.el5{color:#cc0000}{<em>}xen{</em>}{color} #1 SMP Tue
Jun 10 19:20:18 EDT 2008 x86_64 x86_64 x86_64 GNU/Linux
{panel}If &ldquo;xen&rdquo; appears in the output of the previous command, replace the
Xen Kernel with the following commands:
{panel}
yum update ecryptfs-utils -y
yum install kernel kernel-devel -y
yum remove xen kernel-xen -y
{panel}Check the grub.conf file to make sure it is not configured to boot
using the Xen Kernel
{panel}
less /boot/grub/grub.conf 
{panel}The grub.conf file should {color:#cc0000}{<em>}NOT{</em>}{color} look like
this:
{panel}
# grub.conf generated by anaconda
#
# Note that you do not have to rerun grub after making changes to this
file
# NOTICE:  You have a /boot partition.  This means that
#          all kernel and
initrd paths are relative to /boot/, eg.
#          root (hd0,0)
#          kernel
/vmlinuz-version ro root=/dev/sda3
#          initrd
/initrd-version.img
#boot=/dev/sda
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title CentOS (2.6.18-92.el5{color:#cc0000}{<em>}xen{</em>}{color})
        root (hd0,0)
        kernel /xen.gz-2.6.18-92.el5
        module
/vmlinuz-2.6.18-92.el5{color:#cc0000}{<em>}xen{</em>}{color} ro root=LABEL=/
pci=nommconf
        module
/initrd-2.6.18-92.el5xen.img
{panel}The grub.conf file {color:#336600}{<em>}SHOULD{</em>}{color} look like
this:
{panel}
# grub.conf generated by anaconda
#
# Note that you do not have to rerun grub after making changes to this
file
# NOTICE:  You have a /boot partition.  This means that
#          all kernel and
initrd paths are relative to /boot/, eg.
#          root (hd0,0)
#          kernel
/vmlinuz-version ro root=/dev/sda3
#          initrd
/initrd-version.img
#boot=/dev/sda
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title CentOS (2.6.18-128.1.14.el5)
        root (hd0,0)
        kernel
/vmlinuz-2.6.18-128.1.14.el5 ro root=LABEL=/1 pci=nommconf
        initrd
/initrd-2.6.18-128.1.14.el5.img
{panel}After removing the Xen kernel, reboot the computer:
{panel}
reboot
{panel}</p>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-InstallVMwareServer"></a></p>
<h2 id="install-vmware-server">Install VMware Server</h2>
<p>Download the latest VMware Server 1.x RPM from <a href="http://www.vmware.com">http://www.vmware.com</a>
(Note: these instructions assume you saved the RPM into /install)</p>
<p>Install the VMware Server RPM:
{panel}
rpm -ivh /install/VMware-server-1.0.8-126538.i386.rpm
{panel}Configure VMware Server:
{panel}
vmware-config.pl
{panel}{<em>}Note:</em> if you receive an error message you may need to install or
update some libraries and then run vmware-config.pl again:
{panel}
yum install glibc-devel -y
yum install glibc -y 
yum install libXtst-devel -y
{panel}VMware networking should be configured as follows after answering
the questions asked by vmware-config.pl</p>
<ul>
<li>vmnet0 is bridged to eth1</li>
<li>vmnet1 is a host-only network on private subnet 192.168.0.0</li>
</ul>
<p>The following lists the sequence of answers to be entered after issuing the
vmware-config.pl command:</p>
<ol>
<li>Press <em>ENTER</em> to view the license agreement, scroll to the bottom, type
<em>yes</em> and press <em>ENTER</em></li>
<li>In which directory do you want to install the mime type icons?
[/usr/share/icons](/usr/share/icons.html)
<em>ENTER</em></li>
<li>What directory contains your desktop menu entry files?
These files have a .desktop file extension. [/usr/share/applications](/usr/share/applications.html)
<em>ENTER</em></li>
<li>In which directory do you want to install the application&rsquo;s icon?
[/usr/share/pixmaps](/usr/share/pixmaps.html)
<em>ENTER</em></li>
<li>None of the pre-built vmmon modules for VMware Server is suitable for
your
running kernel.  Do you want this program to try to build the vmmon
module for
your system (you need to have a C compiler installed on your system)? [yes](yes.html)
<em>ENTER</em></li>
<li>What is the location of the directory of C header files that match your
running
kernel? [/lib/modules/2.6.18-128.1.14.el5/build/include](/lib/modules/2.6.18-128.1.14.el5/build/include.html)
<em>ENTER</em></li>
<li>Do you want networking for your virtual machines? (yes/no/help) [yes](yes.html)
<em>ENTER</em></li>
<li>Your computer has multiple ethernet network interfaces available: eth0,
eth1,
virbr0. Which one do you want to bridge to vmnet0? [eth0](eth0.html)
<em>eth1</em></li>
<li>Do you wish to configure another bridged network? (yes/no) [no](no.html)
<em>ENTER</em></li>
<li>Do you want to be able to use NAT networking in your virtual machines?
(yes/no)
[yes](yes.html)
<em>no</em></li>
<li>Do you want to be able to use host-only networking in your virtual
machines?
[no](no.html)
<em>yes</em></li>
<li>Do you want this program to probe for an unused private subnet?
(yes/no/help)
[yes](yes.html)
<em>no</em></li>
<li>What will be the IP address of your host on the private
network? <em>192.168.0.1</em></li>
<li>What will be the netmask of your private network? <em>255.255.0.0</em></li>
<li>DHCP information is displayed, press <em>ENTER</em></li>
<li>Do you wish to configure another host-only network? (yes/no) [no](no.html)
<em>ENTER</em></li>
<li>The default port : 902 is not free. We have selected a suitable
alternative
port for VMware Server use. You may override this value now.
Remember to use this port when connecting to this server.
Please specify a port for remote console connections to use [904](904.html)
<em>ENTER</em></li>
<li>In which directory do you want to keep your virtual machine files?
[/var/lib/vmware/Virtual Machines](/var/lib/vmware/virtual-machines.html)
<em>ENTER</em></li>
<li>The path &ldquo;/var/lib/vmware/Virtual Machines&rdquo; does not exist currently.
This
program is going to create it, including needed parent directories. Is this
what you want? [yes](yes.html)
<em>ENTER</em></li>
<li>Please enter your 20-character serial number
Type XXXXX-XXXXX-XXXXX-XXXXX or &lsquo;Enter&rsquo; to cancel: <em>enter the serial
number</em></li>
</ol>
<p>Verify the host-only network was configured correctly:
{panel}
/sbin/ifconfig
{panel}You should see a <em>vmnet1</em> interface using IP address <em>192.168.0.1</em>:
{panel}
<em>vmnet1</em>    Link encap:Ethernet  HWaddr
00:50:56:C0:00:01
          inet
addr:<em>192.168.0.1</em>  Bcast:192.168.255.255  Mask:255.255.0.0
          inet6 addr:
fe80::250:56ff:fec0:1/64 Scope:Link
          UP BROADCAST RUNNING
MULTICAST  MTU:1500  Metric:1
          RX packets:0
errors:0 dropped:0 overruns:0 frame:0
          TX packets:4
errors:0 dropped:0 overruns:0 carrier:0
          collisions:0
txqueuelen:1000
          RX bytes:0 (0.0
b)  TX bytes:0 (0.0 b)
{panel}Restart the vmware service (<em>/sbin/service vmware restart</em>), you
should see the following:
{panel}
Starting VMware services:
   Virtual machine monitor                                  [ OK ](-ok-.html)
   Virtual ethernet                                         [ OK ](-ok-.html)
   Bridged networking on /dev/vmnet0                        [ OK ](-ok-.html)
   Host-only networking on /dev/vmnet1 (background) [ OK ](-ok-.html)
   Starting VMware virtual machines&hellip;                     [ OK ](-ok-.html)
{panel}</p>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-Configure/etc/hosts"></a></p>
<h2 id="configure-etchosts">Configure /etc/hosts</h2>
<p>Modify the /etc/hosts file to include entries for the VM host and guest
computers:
{panel}
vi /etc/hosts
{panel}Add the entries in bold:
{panel}
127.0.0.1 localhost
<em>192.168.0.1 localvmhost</em>
<em>192.168.1.1 vmguest-1</em>
{panel}</p>
<p>h2. Configure the sshd Service to Listen on the Virtual Private
Network </p>
<p>{panel}
vi /etc/ssh/sshd_config
{panel}Add the following line to the end of the file:
{panel}
ListenAddress 192.168.0.1
{panel}Restart the sshd service on the management node:
{panel}
/sbin/service sshd restart
{panel}</p>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-ConfigureTheVMHostToBeAbleToSSHToItself"></a></p>
<h2 id="configure-the-vm-host-to-be-able-to-ssh-to-itself">Configure The VM Host To Be Able To SSH To Itself</h2>
<p>Add the VM host&rsquo;s public key to its own authorized_keys file to allow it to
SSH to itself without a password prompt: 
{panel}
cat /etc/vcl/vcl.key.pub &raquo; /root/.ssh/authorized_keys
{panel}The following command should execute without having to enter a
password:
{panel}
ssh localvmhost &lsquo;ls /&rsquo;
{panel}</p>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-Configurevcldtousevcl.key"></a></p>
<h2 id="configure-vcld-to-use-vclkey">Configure vcld to use vcl.key</h2>
<p>Configure the keys column in the managementnode table in the VCL database</p>
<ul>
<li>Edit the managementnode table in the database: set the <em>keys</em> column to
<em>/etc/vcl/vcl.key</em></li>
</ul>
<p>Configure the vcld.conf file to use vcl.key:
{panel}
vi /etc/vcl/vcld.conf
{panel}Modify all of the IDENTITY lines to specify the vcl.key file:
{panel}
IDENTITY_blade_linux=/etc/vcl/vcl.key
IDENTITY_solaris_lab=/etc/vcl/vcl.key
IDENTITY_linux_lab=/etc/vcl/vcl.key
IDENTITY_blade_win=/etc/vcl/vcl.key
{panel}</p>
<p><a name="ConfiguringaStandaloneVCLEnvironmentusingVMwareServer1.x-ConfigureThe&nbsp;DHCPService&nbsp;"></a></p>
<h2 id="configure-thenbspdhcp-servicenbsp">Configure The DHCP Service </h2>
<p>Save a copy of the original dhcpd.conf file:
{panel}
mv /etc/dhcpd.conf /etc/dhcpd.conf.orig
{panel}Configure the dhcpd.conf file:
{panel}
vi /etc/dhcpd.conf
{panel}The dhcpd.conf file should contain the following:</p>
<pre><code>ddns-update-style none; shared-network vmnet1 {
 ������� subnet 192.168.0.0 netmask 255.255.0.0 {
 ��������������� ignore unknown-clients;
 ��������������� option routers 192.168.0.1;
���������������  host vmguest-1 {
 ����������������������� option host-name &quot;vmguest-1&quot;;
 ����������������������� hardware ethernet 00:50:56:1a:01:01;
 ����������������������� fixed-address 192.168.1.1;
 ����������������������� filename &quot;/tftpboot/pxelinux.0&quot;;
 ����������������������� option dhcp-server-identifier 192.168.0.1;
 ����������������������� next-server 192.168.0.1;
 ��������������� }
      }
}
</code></pre>
<p>The DHCP daemon should only listen on the virtual private network (vmnet1)
to avoid conflicts with other production VCL networks.  Configure the
dhcpd service startup script to only listen on the vmnet1 interface:
{panel}
vi /etc/init.d/dhcpd
{panel}Add <em>vmnet1</em> the to the <em>daemon $dhcpd</em> line as shown:</p>
<pre><code>start() {
 [ -x $dhcpd ]
</code></pre>
<p>|| return 5
[ -f $conf ]
|| return 6
pidofproc $prog &gt;/dev/null 2&gt;&amp;1
RETVAL=$?
[ $RETVAL -eq 0 ]
&amp;&amp; return $RETVAL
echo -n $&quot;Starting $prog: &quot;
daemon $dhcpd vmnet1 $DHCPDARGS 2&gt;/dev/null
RETVAL=$?
echo
[ $RETVAL = 0 ]
&amp;&amp; touch $lockfile
return $RETVAL
}</p>
<p>Configure the dhcpd service to automatically start at runlevels 3-5:
{panel}
/sbin/chkconfig --level 345 dhcpd on
{panel}Start the dhcpd service:  
{panel}
/sbin/service dhcpd start
{panel}</p>


  </div>
  
  <div id="footer">
    <div class="copyright">
      <p>
        Copyright &copy; 2020 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        <br />
        Apache and the Apache feather logo are trademarks of The Apache Software Foundation.
      </p>
    </div>
  </div>
  
</body>
</html>
